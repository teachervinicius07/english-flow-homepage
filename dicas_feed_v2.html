<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dicas – English Flow</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: var(--light-gray); color: #1f2937; line-height: 1.7; }

    nav {
      position: sticky; top: 0; z-index: 1000;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    nav .nav-container {
      max-width: 1100px; margin: auto; padding: 14px 20px;
      display: flex; justify-content: space-between; align-items: center;
    }
    nav a { text-decoration: none; color: var(--gray); font-weight: 500; margin-left: 20px; }
    nav a:hover { color: var(--blue-deep); }

    .cta {
      background-color: var(--blue-deep);
      color: var(--white) !important;
      padding: 12px 26px;
      border-radius: 30px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    header {
      background: linear-gradient(135deg, var(--blue), var(--blue-deep));
      padding: 90px 20px;
      text-align: center;
    }
    header h1 { font-size: 2.6rem; margin-bottom: 10px; }
    header h2 { font-weight: 400; color: var(--light-gray); }

    section { padding: 90px 20px; max-width: 1100px; margin: auto; }
    section h3 { font-size: 2.2rem; margin-bottom: 30px; }

    footer { background: #0f172a; color: #dbeafe; text-align: center; padding: 50px 20px; }

    /* FEED */
    .feed-header{
      display:flex; flex-wrap:wrap; gap:14px;
      align-items:center; justify-content:space-between;
      margin-bottom: 22px;
    }
    .feed-controls{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
    }
    .input{
      width: min(380px, 100%);
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid #d1d5db;
      background: rgba(255,255,255,0.92);
      outline: none;
      font-size: 1rem;
    }
    .input:focus{ border-color: var(--blue-deep); }

    .pill{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: rgba(255,255,255,0.92);
      cursor: pointer;
      font-weight: 600;
      color: #111827;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill.active{
      border-color: var(--blue-deep);
      box-shadow: 0 10px 26px rgba(0,0,0,0.08);
    }

    .feed-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
    }

    .post-card{
      background: var(--white);
      border-radius: 26px;
      box-shadow: 0 16px 36px rgba(0,0,0,0.08);
      padding: 28px;
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height: 220px;
      position: relative;
      overflow:hidden;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .post-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 20px 46px rgba(0,0,0,0.12);
    }

    .post-meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color: var(--gray);
      font-size: .95rem;
    }
    .tag{
      background: rgba(79, 179, 230, 0.12);
      color: #0f4c75;
      border: 1px solid rgba(79, 179, 230, 0.28);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: .82rem;
    }
    .post-title{ font-size: 1.25rem; line-height: 1.25; margin-top: 2px; }
    .post-excerpt{ color: #374151; margin-top: 4px; }
    .readmore{
      margin-top: auto;
      display:inline-flex; align-items:center; gap:10px;
      font-weight: 800; color: var(--blue-deep);
      text-decoration:none;
    }

    .empty{
      padding: 26px;
      border-radius: 26px;
      background: rgba(255,255,255,0.75);
      border: 1px dashed #d1d5db;
      color: var(--gray);
    }
    .debug{
      margin-top: 10px;
      font-size: .95rem;
      color: #0f172a;
      background: rgba(255,255,255,0.75);
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      border-radius: 16px;
      overflow-wrap: anywhere;
    }
    .debug code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* MODAL */
    .modal-backdrop{
      position: fixed; inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 2000;
    }
    .modal-backdrop.show{ display:flex; }

    .modal{
      width: 100%;
      max-width: 860px;
      background: var(--white);
      border-radius: 26px;
      box-shadow: 0 22px 60px rgba(0,0,0,0.25);
      padding: 34px;
      position: relative;
      transform: translateY(8px);
      opacity: 0;
      transition: .18s ease;
      max-height: 80vh;
      overflow: auto;
    }
    .modal-backdrop.show .modal{ transform: translateY(0); opacity: 1; }
    .modal-close{
      position:absolute; top: 14px; right: 16px;
      width: 40px; height: 40px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fff;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }
    .modal h3{ font-size: 1.7rem; margin-bottom: 8px; }
    .modal .modal-meta{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color: var(--gray); margin-bottom: 16px;
    }
    .modal .content p{ margin-bottom: 14px; }
    .modal .content ul{ padding-left: 22px; margin: 14px 0; }
    .modal .content li{ margin-bottom: 8px; }

    @media (prefers-reduced-motion: reduce){
      .post-card, .modal{ transition: none; }
      .post-card:hover{ transform: none; }
    }
    @media (max-width: 560px){
      header h1{ font-size: 2.1rem; }
      section{ padding: 70px 16px; }
      .post-card{ padding: 22px; }
      .modal{ padding: 22px; }
    }
  </style>
</head>
<body>

<nav>
  <div class="nav-container">
    <strong>English Flow</strong>
    <div>
      <a href="index.html">Início</a>
      <a href="planos.html">Planos</a>
      <a href="sobre.html">Sobre Nós</a>
      <a href="dicas.html">Dicas</a>
      <a href="teste-nivel.html">Teste de Nível</a>
      <a href="contato.html" class="cta">Contato</a>
    </div>
  </div>
</nav>

<header>
  <h1>Dicas & Reflexões</h1>
  <h2>Aprender inglês com consciência, método e contexto</h2>
</header>

<section>
  <div class="feed-header">
    <div>
      <h3 style="margin-bottom:6px;">Últimas postagens</h3>
      <p style="color: var(--gray); max-width: 62ch;">
        Um feed atualizado com dicas práticas, reflexões e comparações éticas entre caminhos para estudar inglês.
      </p>
    </div>

    <div class="feed-controls">
      <input id="searchInput" class="input" type="search" placeholder="Buscar por título, tema ou palavra-chave…" aria-label="Buscar posts">
      <button id="tagAll" class="pill active" type="button">Tudo</button>
      <button id="tagMetodo" class="pill" type="button">Método</button>
      <button id="tagEscolas" class="pill" type="button">Escolas</button>
    </div>
  </div>

  <div id="feed" class="feed-grid" aria-live="polite"></div>

  <div style="text-align:center; margin-top:34px;">
    <a href="teste-nivel.html" class="cta" style="margin:10px; display:inline-block;">Fazer teste de nível</a>
    <a href="contato.html" class="cta" style="margin:10px; display:inline-block;">Entrar em contato</a>
  </div>
</section>

<div id="postModalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="postModalTitle">
  <div class="modal">
    <button class="modal-close" id="closeModalBtn" aria-label="Fechar">×</button>
    <h3 id="postModalTitle"></h3>
    <div class="modal-meta" id="postModalMeta"></div>
    <div class="content" id="postModalContent"></div>
  </div>
</div>

<footer>
  © 2026 – English Flow | Professor Vinícius<br/>Conteúdo informativo e educacional
</footer>

<script>
  // =========================================================
  // Carregamento robusto do JSON (funciona em:
  // - domínio próprio (raiz)
  // - GitHub Pages em subpasta (/repo/)
  // - sem precisar mudar o caminho manualmente)
  // =========================================================

  const FEED_EL = document.getElementById('feed');
  const searchInput = document.getElementById('searchInput');

  const tagAll = document.getElementById('tagAll');
  const tagMetodo = document.getElementById('tagMetodo');
  const tagEscolas = document.getElementById('tagEscolas');

  const modalBackdrop = document.getElementById('postModalBackdrop');
  const closeModalBtn = document.getElementById('closeModalBtn');
  const modalTitle = document.getElementById('postModalTitle');
  const modalMeta = document.getElementById('postModalMeta');
  const modalContent = document.getElementById('postModalContent');

  let POSTS = [];
  let activeTag = 'all';

  // 1) Primeiro tentamos um caminho relativo ao arquivo atual (mais robusto)
  const CANDIDATES = [
    new URL('./data/posts.json', window.location.href).toString(),
    'data/posts.json',
    '/data/posts.json'
  ];

  function formatDate(iso){
    try{
      const d = new Date(iso + 'T00:00:00');
      return d.toLocaleDateString('pt-BR', { day:'2-digit', month:'long', year:'numeric' });
    }catch(e){ return iso; }
  }

  function normalize(str){
    return (str || '').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
  }

  function stripHtml(html){
    return (html || '').toString().replace(/<[^>]*>/g,' ');
  }

  function escapeHtml(str){
    return (str || '').toString()
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  function render(){
    const q = normalize(searchInput.value.trim());
    const filtered = POSTS.filter(p => {
      const matchesTag = activeTag === 'all'
        ? true
        : (p.tags || []).map(t => normalize(t)).includes(normalize(activeTag));
      if(!matchesTag) return false;

      if(!q) return true;

      const hay = normalize([p.title, p.excerpt, (p.tags || []).join(' '), stripHtml(p.content_html)].join(' '));
      return hay.includes(q);
    });

    FEED_EL.innerHTML = '';

    if(filtered.length === 0){
      FEED_EL.innerHTML = `<div class="empty">Nenhuma postagem encontrada. Tente outro termo de busca ou selecione “Tudo”.</div>`;
      return;
    }

    filtered.forEach(p => {
      const tags = (p.tags || []).slice(0, 3).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('');
      const card = document.createElement('article');
      card.className = 'post-card';
      card.tabIndex = 0;
      card.setAttribute('role','button');
      card.setAttribute('aria-label', 'Abrir postagem: ' + p.title);

      card.innerHTML = `
        <div class="post-meta">
          <span>${formatDate(p.date)}</span>
          ${tags}
        </div>
        <h4 class="post-title">${escapeHtml(p.title)}</h4>
        <p class="post-excerpt">${escapeHtml(p.excerpt || '')}</p>
        <span class="readmore">Ler postagem →</span>
      `;

      card.addEventListener('click', () => openPost(p));
      card.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          openPost(p);
        }
      });

      FEED_EL.appendChild(card);
    });
  }

  function openPost(p){
    modalTitle.textContent = p.title;
    const tags = (p.tags || []).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('');
    modalMeta.innerHTML = `<span>${formatDate(p.date)}</span>${tags ? ' ' + tags : ''}`;
    modalContent.innerHTML = p.content_html || '';
    modalBackdrop.classList.add('show');
    document.body.style.overflow = 'hidden';
    closeModalBtn.focus();
  }

  function closeModal(){
    modalBackdrop.classList.remove('show');
    document.body.style.overflow = '';
  }

  modalBackdrop.addEventListener('click', (e) => {
    if(e.target === modalBackdrop) closeModal();
  });
  closeModalBtn.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && modalBackdrop.classList.contains('show')) closeModal();
  });

  function setActiveTag(tag){
    activeTag = tag;
    [tagAll, tagMetodo, tagEscolas].forEach(b => b.classList.remove('active'));
    if(tag === 'all') tagAll.classList.add('active');
    if(tag === 'método') tagMetodo.classList.add('active');
    if(tag === 'escolas') tagEscolas.classList.add('active');
    render();
  }

  tagAll.addEventListener('click', () => setActiveTag('all'));
  tagMetodo.addEventListener('click', () => setActiveTag('método'));
  tagEscolas.addEventListener('click', () => setActiveTag('escolas'));

  searchInput.addEventListener('input', () => render());

  async function fetchFirstOk(urls){
    let lastErr = null;
    for(const url of urls){
      try{
        const res = await fetch(url, { cache: 'no-store' });
        if(!res.ok) throw new Error(`HTTP ${res.status} em ${url}`);
        const data = await res.json();
        return { data, url };
      }catch(err){
        lastErr = err;
      }
    }
    throw lastErr || new Error('Falha ao buscar posts.json');
  }

  async function init(){
    try{
      const { data, url } = await fetchFirstOk(CANDIDATES);
      POSTS = (Array.isArray(data) ? data : []).slice()
        .sort((a,b) => (b.date || '').localeCompare(a.date || ''));

      render();

      // Se quiser debugar no console:
      // console.log('Feed carregado de:', url, POSTS);
    }catch(err){
      const attempted = CANDIDATES.map(u => `<li><code>${escapeHtml(u)}</code></li>`).join('');
      FEED_EL.innerHTML = `
        <div class="empty">
          Não foi possível carregar o feed agora.
          <div class="debug">
            <strong>Possíveis causas:</strong>
            <ul style="margin:10px 0 0; padding-left:18px;">
              <li>Você está abrindo o arquivo localmente (file://). O fetch pode ser bloqueado. Teste via GitHub Pages.</li>
              <li>O caminho do JSON no repositório não está exatamente <code>data/posts.json</code> (atenção a maiúsculas/minúsculas).</li>
              <li>O arquivo não foi commitado/publicado na branch que o Pages usa.</li>
            </ul>
            <div style="margin-top:10px;"><strong>URLs tentadas:</strong><ul style="margin-top:6px; padding-left:18px;">${attempted}</ul></div>
            <div style="margin-top:10px;"><strong>Erro:</strong> <code>${escapeHtml(err.message || String(err))}</code></div>
          </div>
        </div>
      `;
      console.error(err);
    }
  }

  init();
</script>

</body>
</html>
